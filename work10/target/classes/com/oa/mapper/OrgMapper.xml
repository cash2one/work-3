<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.oa.mapper.OrgMapper">
  <resultMap id="BaseResultMap" type="com.oa.entity.Org">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 07 23:51:06 CST 2017.
    -->
    <id column="ORG_ID" jdbcType="BIGINT" property="orgId" />
    <result column="ORG_PARENT_ID" jdbcType="BIGINT" property="orgParentId" />
    <result column="IS_PARENT" jdbcType="SMALLINT" property="isParent" />
    <result column="ORG_NAME" jdbcType="VARCHAR" property="orgName" />
    <result column="ORG_PATH" jdbcType="VARCHAR" property="orgPath" />
    <result column="ORG_DESC" jdbcType="VARCHAR" property="orgDesc" />
    <result column="DISP_INDEX" jdbcType="SMALLINT" property="dispIndex" />
    <result column="STATE" jdbcType="SMALLINT" property="state" />
    <result column="CREATED_DATE" jdbcType="TIMESTAMP" property="createdDate" />
    <!-- 该组织的父组织 -->
    <result column="orgParentName" jdbcType="TIMESTAMP" property="orgParentName" />
  </resultMap>
  <sql id="Base_Column_List">
   
    ORG_ID, ORG_PARENT_ID, IS_PARENT, ORG_NAME, ORG_PATH, ORG_DESC, DISP_INDEX, STATE, 
    CREATED_DATE
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Long" resultMap="BaseResultMap">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 07 23:51:06 CST 2017.
    -->
    select 
    <include refid="Base_Column_List" />
    from sys_org
    where ORG_ID = #{orgId,jdbcType=BIGINT}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Long">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 07 23:51:06 CST 2017.
    -->
    delete from sys_org
    where ORG_ID = #{orgId,jdbcType=BIGINT}
  </delete>
  <insert id="insert" parameterType="java.util.Map">
  
    insert into sys_org ( ORG_PARENT_ID, IS_PARENT, 
      ORG_NAME, ORG_PATH, ORG_DESC, 
      DISP_INDEX, STATE, CREATED_DATE
      )
    values (#{orgParentId,jdbcType=BIGINT}, #{isParent,jdbcType=SMALLINT}, 
      #{orgName,jdbcType=VARCHAR}, #{orgPath,jdbcType=VARCHAR}, #{orgDesc,jdbcType=VARCHAR}, 
      #{dispIndex,jdbcType=SMALLINT}, #{state,jdbcType=SMALLINT},now()
      )
      <!-- orgParentId,isParent与参数的map的键一致 
      orgPath：计算： orgParentPath+ orgId
       -->
  </insert>
  
  <!-- 查询新增的对象的id -->
  <select id="selectOrgId" resultType="long" >
  	select max(org_id) from sys_org
  </select>
  
  <insert id="insertSelective" parameterType="com.oa.entity.Org">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 07 23:51:06 CST 2017.
    -->
    insert into sys_org
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="orgId != null">
        ORG_ID,
      </if>
      <if test="orgParentId != null">
        ORG_PARENT_ID,
      </if>
      <if test="isParent != null">
        IS_PARENT,
      </if>
      <if test="orgName != null">
        ORG_NAME,
      </if>
      <if test="orgPath != null">
        ORG_PATH,
      </if>
      <if test="orgDesc != null">
        ORG_DESC,
      </if>
      <if test="dispIndex != null">
        DISP_INDEX,
      </if>
      <if test="state != null">
        STATE,
      </if>
      <if test="createdDate != null">
        CREATED_DATE,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="orgId != null">
        #{orgId,jdbcType=BIGINT},
      </if>
      <if test="orgParentId != null">
        #{orgParentId,jdbcType=BIGINT},
      </if>
      <if test="isParent != null">
        #{isParent,jdbcType=SMALLINT},
      </if>
      <if test="orgName != null">
        #{orgName,jdbcType=VARCHAR},
      </if>
      <if test="orgPath != null">
        #{orgPath,jdbcType=VARCHAR},
      </if>
      <if test="orgDesc != null">
        #{orgDesc,jdbcType=VARCHAR},
      </if>
      <if test="dispIndex != null">
        #{dispIndex,jdbcType=SMALLINT},
      </if>
      <if test="state != null">
        #{state,jdbcType=SMALLINT},
      </if>
      <if test="createdDate != null">
        #{createdDate,jdbcType=TIMESTAMP},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.oa.entity.Org">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 07 23:51:06 CST 2017.
    -->
    update sys_org
    <set>
      <if test="orgParentId != null">
        ORG_PARENT_ID = #{orgParentId,jdbcType=BIGINT},
      </if>
      <if test="isParent != null">
        IS_PARENT = #{isParent,jdbcType=SMALLINT},
      </if>
      <if test="orgName != null">
        ORG_NAME = #{orgName,jdbcType=VARCHAR},
      </if>
      <if test="orgPath != null">
        ORG_PATH = #{orgPath,jdbcType=VARCHAR},
      </if>
      <if test="orgDesc != null">
        ORG_DESC = #{orgDesc,jdbcType=VARCHAR},
      </if>
      <if test="dispIndex != null">
        DISP_INDEX = #{dispIndex,jdbcType=SMALLINT},
      </if>
      <if test="state != null">
        STATE = #{state,jdbcType=SMALLINT},
      </if>
      <if test="createdDate != null">
        CREATED_DATE = #{createdDate,jdbcType=TIMESTAMP},
      </if>
    </set>
    where ORG_ID = #{orgId,jdbcType=BIGINT}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.oa.entity.Org">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 07 23:51:06 CST 2017.
    -->
    update sys_org
    set ORG_PARENT_ID = #{orgParentId,jdbcType=BIGINT},
      IS_PARENT = #{isParent,jdbcType=SMALLINT},
      ORG_NAME = #{orgName,jdbcType=VARCHAR},
      ORG_PATH = #{orgPath,jdbcType=VARCHAR},
      ORG_DESC = #{orgDesc,jdbcType=VARCHAR},
      DISP_INDEX = #{dispIndex,jdbcType=SMALLINT},
      STATE = #{state,jdbcType=SMALLINT},
      CREATED_DATE = #{createdDate,jdbcType=TIMESTAMP}
    where ORG_ID = #{orgId,jdbcType=BIGINT}
  </update>
  
  <sql id="whereClause">
  	<where>
  		<if test="parentId!=null and parentId!='' ">
  			ORG_PARENT_ID = #{parentId}
  		</if>
  		<if test="state!=null and state!='' ">
  			and state = #{state}
  		</if>
  	</where>
  </sql>
  
  <!-- 组织管理  查询所有组织  where …… and  ……   limit ?,? -->
  <select id="selectOrgByPage" parameterType="java.util.Map" resultMap="BaseResultMap">
  	 select 
  	 <include refid="Base_Column_List" />
  	 from sys_org
  	  <include refid="whereClause" />
  	 order by  org_Id  desc  limit #{startIndex},#{pageSize}
  </select>
  
  <select id="selectTotalCount" parameterType="java.util.Map" resultType="long">
     select count(*) from sys_org
     <include refid="whereClause" />
  </select>
  
  <!-- 点击选择时查询树形菜单的 sql-->
  <select id="selectOrgListByParentId" parameterType="long" resultMap="BaseResultMap">
  	  select  *  from sys_org where org_parent_id = #{parentId}
  </select>
  
   <sql id="Base_Column_List2">
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Wed Jun 07 23:51:06 CST 2017.
    -->
    o.ORG_ID, o.ORG_PARENT_ID, o.IS_PARENT, o.ORG_NAME, o.ORG_PATH, o.ORG_DESC, o.DISP_INDEX, o.STATE, 
    o.CREATED_DATE,p.org_name orgParentName
  </sql>
  <!-- 根据id查询组织以及该组织的父组织 -->
  <select id="selectOrgAndParentByOrgId" parameterType="long" resultMap="BaseResultMap">
  	select 
  	<include refid="Base_Column_List2"></include>
  	from sys_org O,sys_org P where O.ORG_PARENT_ID = P.ORG_ID AND O.ORG_ID = #{orgId,jdbcType=BIGINT}
  </select>
 
  <!-- g根据组织的名称查询组织的id -->
	<select id="selectOrgIdByOrgName" resultType="int" parameterType="String">
		select org_Id orgId from sys_org where
		org_name = #{orgName}
	</select>
	
 <sql id="Base_Column_List_org">   
    o.ORG_ID, ORG_PARENT_ID, IS_PARENT, ORG_NAME, ORG_PATH, ORG_DESC, DISP_INDEX, STATE, 
    o.CREATED_DATE
  </sql>
	<!-- 查询角色下的组织信息 -->
	<select id="selectRoleOrgList" parameterType="java.util.Map" resultMap="BaseResultMap">
		select 
		<include refid="Base_Column_List_org"></include>
		from sys_org o, sys_role_org_rel r
		where o.org_id	= r.org_id
		and r.role_id = #{roleId}
		limit #{startIndex},#{pageSize}
	</select>
	<select id="selectRoleOrgListCount" parameterType="java.util.Map" resultType="int">
		select count(*) from 
		 sys_org o, sys_role_org_rel r
		where o.org_id	= r.org_id
		and r.role_id = #{roleId}
	</select>
 
 
  
  	  
</mapper>